<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Account - Boat Revival</title>
<style>
body { margin:0; font-family:Verdana,sans-serif; background:#ffe6f0; color:#333; text-align:center; padding:50px 20px; }
.button { background-color:#ff69b4; color:white; padding:15px 40px; text-decoration:none; font-size:1.3em; border-radius:10px; display:inline-block; margin:10px; transition:transform 0.2s; cursor:pointer; }
.button:hover { transform:scale(1.1); background-color:#ff4c99; }
img { width:100px; height:100px; border-radius:50%; margin-bottom:20px; }
input { padding:10px; margin:5px; width:200px; }
</style>
</head>
<body>

<h1>My Account</h1>
<img id="userPfp" src="" alt="Profile Picture">
<h2 id="userEmail"></h2>
<h3 id="userDisplayName"></h3>

<h3>Change Display Name</h3>
<input type="text" id="displayName" placeholder="New Display Name"><br>
<button class="button" onclick="changeDisplayName()">Update Name</button>
<p id="nameMessage" style="color:red;"></p>

<h3>Change Profile Picture</h3>
<input type="file" id="pfpUpload" accept="image/png, image/jpeg"><br>
<button class="button" onclick="changePFP()">Upload</button>
<p id="pfpMessage" style="color:red;"></p>

<h3>Change Password</h3>
<input type="password" id="newPassword" placeholder="New Password"><br>
<button class="button" onclick="changePassword()">Update Password</button>
<p id="passMessage" style="color:red;"></p>

<br>
<button class="button" onclick="logout()">Logout</button>
<br>
<a href="index.html" class="button">Home</a>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged, updatePassword, updateProfile } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBAffjU7-HLGsXPmdXSqjXS3KxgXxc7tBA",
  authDomain: "boat-revival.firebaseapp.com",
  projectId: "boat-revival",
  storageBucket: "boat-revival.appspot.com",
  messagingSenderId: "207519236382",
  appId: "1:207519236382:web:3a61a1b8811fd811e0c90f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const storage = getStorage(app);

// Show user info
function showUser(user){
  document.getElementById("userEmail").innerText = user.email;
  document.getElementById("userPfp").src = user.photoURL || 'https://www.gravatar.com/avatar/?d=mp';
  document.getElementById("userDisplayName").innerText = user.displayName || "No display name";
}

// Logout
window.logout = function(){
  signOut(auth).then(()=>{
    window.location.href="index.html";
  });
}

// Change password
window.changePassword = function(){
  const newPass = document.getElementById("newPassword").value;
  if(!newPass){ document.getElementById("passMessage").innerText = "Enter a new password"; return; }
  const user = auth.currentUser;
  updatePassword(user, newPass)
    .then(()=>{ 
      document.getElementById("passMessage").style.color="green"; 
      document.getElementById("passMessage").innerText="Password updated!";
    })
    .catch(error=>{ 
      document.getElementById("passMessage").style.color="red"; 
      document.getElementById("passMessage").innerText = error.message;
    });
}

// Change display name
window.changeDisplayName = function(){
  const newName = document.getElementById("displayName").value;
  if(!newName){ document.getElementById("nameMessage").innerText="Enter a display name"; return; }
  const user = auth.currentUser;
  updateProfile(user, { displayName: newName })
    .then(()=>{
      document.getElementById("nameMessage").style.color="green";
      document.getElementById("nameMessage").innerText="Display name updated!";
      showUser(user);
    })
    .catch(error=>{
      document.getElementById("nameMessage").style.color="red";
      document.getElementById("nameMessage").innerText=error.message;
    });
}

// Change profile picture
window.changePFP = async function(){
  const file = document.getElementById("pfpUpload").files[0];
  if(!file){ document.getElementById("pfpMessage").innerText="Select an image"; return; }
  if(file.size > 2*1024*1024){ document.getElementById("pfpMessage").innerText="Max size 2MB"; return; }

  const user = auth.currentUser;
  if(!user) return;

  try {
    const storageRef = ref(storage, `pfp/${user.uid}.png`);
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);
    await updateProfile(user, { photoURL: url });
    document.getElementById("userPfp").src = url;
    document.getElementById("pfpMessage").style.color="green";
    document.getElementById("pfpMessage").innerText="Profile picture updated!";
  } catch(error){
    document.getElementById("pfpMessage").style.color="red";
    document.getElementById("pfpMessage").innerText = error.message;
  }
}

// Redirect if not logged in
onAuthStateChanged(auth, user=>{
  if(user){ showUser(user); }
  else{ window.location.href="index.html"; }
});
</script>

</body>
</html>
