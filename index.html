<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boat Revival</title>
<style>
body { margin:0; font-family:Verdana,sans-serif; background:#ffe6f0; color:#333; }
header { background:#ff5da2; padding:15px 25px; display:flex; align-items:center; }
header img { width:50px; height:50px; border-radius:50%; margin-right:15px; }
header h1 { margin:0; font-size:1.8em; color:white; flex-grow:1; }
nav a { margin:0 15px; color:#fff; text-decoration:none; font-weight:bold; }
nav a:hover { color:#ffccdd; }
main { padding:30px; }
.button { background-color:#ff69b4; color:white; padding:10px 20px; text-decoration:none; font-size:1em; border-radius:10px; display:inline-block; margin:5px; transition:transform 0.2s; cursor:pointer; }
.button:hover { transform:scale(1.05); background-color:#ff4c99; }
input { padding:8px; margin:5px; width:200px; border-radius:6px; border:1px solid #ccc; }
section { margin-bottom:40px; }
#loginForm, #welcome, #friendsSection { background:white; padding:20px; border-radius:10px; margin-top:20px; display:inline-block; }
#welcome img { width:40px; height:40px; border-radius:50%; vertical-align:middle; margin-right:8px; }
.friend { display:flex; align-items:center; margin:5px 0; }
.friend img { width:30px; height:30px; border-radius:50%; margin-right:10px; }
footer { background:#ff5da2; padding:15px; text-align:center; color:#fff; position:fixed; width:100%; bottom:0; }
</style>
</head>
<body>

<header>
  <img src="https://www.roblox.com/favicon.ico" alt="Logo">
  <h1>Boat Revival</h1>
  <nav>
    <a href="#home">Home</a>
    <a href="#friends">Friends</a>
    <a href="#account">Account</a>
  </nav>
</header>

<main>
  <!-- HOME -->
  <section id="home">
    <h2>Home</h2>
    <p>Welcome to Boat Revival â€” a classic Roblox revival project.</p>
    <a href="#" class="button">Play Now</a>
  </section>

  <!-- FRIENDS -->
  <section id="friends">
    <h2>Friends</h2>
    <div id="friendsSection" style="display:none;">
      <p>You have <span id="friendCount">0</span> friends:</p>
      <div id="friendList"></div>
      <h3>Add Friend</h3>
      <input type="text" id="friendSearch" placeholder="Search display name">
      <button class="button" onclick="searchUser()">Search</button>
      <div id="searchResult"></div>
    </div>
    <p id="friendsMessage" style="color:red;"></p>
  </section>

  <!-- ACCOUNT -->
  <section id="account">
    <h2>Login / Create Account</h2>
    <div id="loginForm">
      <input type="email" id="email" placeholder="Email"><br>
      <input type="password" id="password" placeholder="Password"><br>
      <button class="button" onclick="signup()">Sign Up</button>
      <button class="button" onclick="login()">Login</button>
      <button class="button" onclick="loginWithGoogle()">Login with Google</button>
      <p id="message" style="margin-top:10px;color:red;"></p>
    </div>
    <div id="welcome" style="display:none;">
      <img id="userPfp" src="" alt="Profile Picture">
      <span>Hello, <span id="userDisplay"></span></span>
      <br>
      <button class="button" onclick="logout()">Logout</button>
    </div>
  </section>
</main>

<footer>
  &copy; 2025 Boat Revival
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBAffjU7-HLGsXPmdXSqjXS3KxgXxc7tBA",
  authDomain: "boat-revival.firebaseapp.com",
  projectId: "boat-revival",
  storageBucket: "boat-revival.appspot.com",
  messagingSenderId: "207519236382",
  appId: "1:207519236382:web:3a61a1b8811fd811e0c90f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

async function ensureUserDoc(user) {
  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);
  if (!snap.exists()) {
    await setDoc(ref, {
      displayName: user.displayName || user.email.split("@")[0],
      friends: [],
      requests: []
    });
  }
}

window.signup = async function(){
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  createUserWithEmailAndPassword(auth,email,password)
    .then(async userCredential=>{
      await ensureUserDoc(userCredential.user);
      showUser(userCredential.user);
    })
    .catch(error=>showMessage(error.message));
}

window.login = function(){
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  signInWithEmailAndPassword(auth,email,password)
    .then(userCredential=>{ showUser(userCredential.user); })
    .catch(error=>showMessage(error.message));
}

window.loginWithGoogle = function(){
  signInWithPopup(auth, provider)
    .then(async result=>{
      await ensureUserDoc(result.user);
      showUser(result.user);
    })
    .catch(error=>showMessage(error.message));
}

window.logout = function(){
  signOut(auth).then(()=>{
    document.getElementById("loginForm").style.display="block";
    document.getElementById("welcome").style.display="none";
    document.getElementById("friendsSection").style.display="none";
  });
}

function showUser(user){
  document.getElementById("loginForm").style.display="none";
  document.getElementById("welcome").style.display="block";
  document.getElementById("friendsSection").style.display="block";
  document.getElementById("userDisplay").innerText=user.email;
  document.getElementById("userPfp").src=user.photoURL || 'https://www.gravatar.com/avatar/?d=mp';
  loadFriends(user.uid);
}

function showMessage(msg,color="red"){
  const p=document.getElementById("message");
  p.style.color=color;
  p.innerText=msg;
}

async function loadFriends(uid){
  const ref = doc(db,"users",uid);
  const snap = await getDoc(ref);
  if(snap.exists()){
    const data = snap.data();
    const list = document.getElementById("friendList");
    list.innerHTML = "";
    (data.friends || []).forEach(f=>{
      const div = document.createElement("div");
      div.className="friend";
      div.innerHTML = `<img src="https://www.gravatar.com/avatar/?d=mp"><span>${f}</span>`;
      list.appendChild(div);
    });
    document.getElementById("friendCount").innerText = data.friends.length;
  }
}

window.searchUser = async function(){
  const name=document.getElementById("friendSearch").value;
  if(!name) return;
  const currentUser=auth.currentUser;
  if(!currentUser) return;
  // In real app you'd query Firestore by displayName; simplified here
  const resultDiv=document.getElementById("searchResult");
  resultDiv.innerHTML=`<p>Found user: ${name} <button class="button" onclick="sendFriendRequest('${name}')">Add Friend</button></p>`;
}

window.sendFriendRequest = async function(name){
  const currentUser=auth.currentUser;
  if(!currentUser) return;
  const ref=doc(db,"users",currentUser.uid);
  const snap=await getDoc(ref);
  if(snap.exists()){
    const data=snap.data();
    await updateDoc(ref,{ friends: arrayUnion(name) });
    loadFriends(currentUser.uid);
    document.getElementById("searchResult").innerHTML="<p>Friend added!</p>";
  }
}

onAuthStateChanged(auth,user=>{
  if(user) { ensureUserDoc(user).then(()=>showUser(user)); }
});
</script>

</body>
</html>