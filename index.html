<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boat Revival - Home</title>
<style>
body { margin:0; font-family:Verdana,sans-serif; background:#fafafa; color:#333; }
header { background:#ff69b4; padding:15px; text-align:center; position:sticky; top:0; z-index:1000; }
#searchBar { padding:10px; width:60%; border-radius:8px; border:1px solid #ccc; }
#searchResults { margin:10px; text-align:center; }

.container { display:grid; grid-template-columns: 250px 1fr 250px; gap:20px; margin:20px; }

.card { background:white; border-radius:12px; padding:20px; box-shadow:0 4px 6px rgba(0,0,0,0.1); margin-bottom:20px; }
.card h2 { margin-top:0; }

.user-card { text-align:center; }
.user-card img { width:100px; height:100px; border-radius:50%; margin-bottom:10px; }

.games-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:20px; }
.game { background:#fff; padding:10px; border-radius:10px; box-shadow:0 2px 4px rgba(0,0,0,0.1); text-align:center; }
.game img { width:100%; border-radius:8px; }

.friend { display:flex; align-items:center; margin-bottom:10px; }
.friend img { width:40px; height:40px; border-radius:50%; margin-right:10px; }

.button { background:#ff69b4; color:white; padding:6px 12px; border:none; border-radius:6px; cursor:pointer; }
.button:hover { background:#ff4c99; }
</style>
</head>
<body>

<header>
  <input id="searchBar" type="text" placeholder="Search players...">
  <div id="searchResults"></div>
</header>

<div class="container">
  <!-- LEFT: User -->
  <div>
    <div id="userCard" class="card user-card">
      <img src="https://www.gravatar.com/avatar/?d=mp" alt="avatar">
      <h2>Hi, Guest</h2>
    </div>
  </div>

  <!-- CENTER: Games -->
  <div>
    <div class="card">
      <h2>ðŸ”¥ Popular Games</h2>
      <div id="gamesGrid" class="games-grid"></div>
    </div>
  </div>

  <!-- RIGHT: Friends -->
  <div>
    <div class="card">
      <h2>ðŸ‘¥ Friends</h2>
      <div id="friendsList"></div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBAffjU7-HLGsXPmdXSqjXS3KxgXxc7tBA",
  authDomain: "boat-revival.firebaseapp.com",
  projectId: "boat-revival",
  storageBucket: "boat-revival.appspot.com",
  messagingSenderId: "207519236382",
  appId: "1:207519236382:web:3a61a1b8811fd811e0c90f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- USER CARD ---
onAuthStateChanged(auth, user=>{
  const card = document.getElementById("userCard");
  if(user){
    card.innerHTML = `
      <img src="${user.photoURL || 'https://www.gravatar.com/avatar/?d=mp'}" alt="avatar">
      <h2>Hi, ${user.displayName || "Player"}</h2>
      <p>${user.email}</p>
    `;
  }
});

// --- SEARCH USERS ---
const searchBar = document.getElementById("searchBar");
const searchResults = document.getElementById("searchResults");

searchBar.addEventListener("input", () => {
  const text = searchBar.value.trim();
  searchResults.innerHTML = "";
  if (text) {
    const btn = document.createElement("button");
    btn.className = "button";
    btn.textContent = `Wanna search person "${text}"?`;
    btn.onclick = () => searchUsers(text);
    searchResults.appendChild(btn);
  }
});

async function searchUsers(name){
  searchResults.innerHTML = "Searching...";
  const q = query(collection(db, "users"), where("displayName", "==", name));
  const snap = await getDocs(q);

  searchResults.innerHTML = "";
  if(snap.empty){
    searchResults.innerHTML = `<p>No user found with name "${name}"</p>`;
    return;
  }

  snap.forEach(doc=>{
    const user = doc.data();
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <img src="${user.photoURL || 'https://www.gravatar.com/avatar/?d=mp'}" style="width:60px; height:60px; border-radius:50%;">
      <h3>${user.displayName}</h3>
      <p>${user.email}</p>
    `;
    searchResults.appendChild(div);
  });
}

// --- GAMES GRID ---
async function loadGames(){
  const snap = await getDocs(collection(db, "games"));
  const grid = document.getElementById("gamesGrid");
  grid.innerHTML = "";
  snap.forEach(doc=>{
    const g = doc.data();
    const div = document.createElement("div");
    div.className = "game";
    div.innerHTML = `
      <img src="${g.thumbnail || 'https://via.placeholder.com/150'}">
      <h3>${g.name}</h3>
      <p>${g.players || 0} playing</p>
    `;
    grid.appendChild(div);
  });
}

// --- FRIENDS LIST ---
async function loadFriends(){
  const snap = await getDocs(collection(db, "users")); // later filter by actual friends
  const list = document.getElementById("friendsList");
  list.innerHTML = "";
  snap.forEach(doc=>{
    const u = doc.data();
    const div = document.createElement("div");
    div.className = "friend";
    div.innerHTML = `
      <img src="${u.photoURL || 'https://www.gravatar.com/avatar/?d=mp'}">
      <span>${u.displayName}</span>
    `;
    list.appendChild(div);
  });
}

loadGames();
loadFriends();
</script>
</body>
</html>