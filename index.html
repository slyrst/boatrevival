<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boat Revival - Home</title>
<style>
body { margin:0; font-family:Verdana,sans-serif; background:#ffe6f0; color:#333; }
header { background:#ff69b4; padding:15px; text-align:center; position:sticky; top:0; z-index:1000; }
#searchBar { padding:10px; width:60%; border-radius:8px; border:1px solid #ccc; }
#searchResults { margin:20px; text-align:center; }
.profile-card { display:inline-block; background:white; padding:20px; margin:10px; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.1); width:180px; }
.profile-card img { width:80px; height:80px; border-radius:50%; }
.catalog { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:20px; margin:20px; }
.item { background:white; border-radius:10px; padding:15px; box-shadow:0 4px 6px rgba(0,0,0,0.1); text-align:center; }
.item img { width:100%; border-radius:10px; }
.button { background:#ff69b4; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; }
.button:hover { background:#ff4c99; }
</style>
</head>
<body>

<header>
  <input id="searchBar" type="text" placeholder="Search players...">
  <div id="searchResults"></div>
</header>

<h1 style="text-align:center; margin-top:20px;">Catalog</h1>
<div id="catalog" class="catalog"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBAffjU7-HLGsXPmdXSqjXS3KxgXxc7tBA",
  authDomain: "boat-revival.firebaseapp.com",
  projectId: "boat-revival",
  storageBucket: "boat-revival.appspot.com",
  messagingSenderId: "207519236382",
  appId: "1:207519236382:web:3a61a1b8811fd811e0c90f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- 🔍 SEARCH SYSTEM ---
const searchBar = document.getElementById("searchBar");
const searchResults = document.getElementById("searchResults");

searchBar.addEventListener("input", () => {
  const text = searchBar.value.trim();
  searchResults.innerHTML = "";
  if (text) {
    const btn = document.createElement("button");
    btn.className = "button";
    btn.textContent = `Wanna search person "${text}"?`;
    btn.onclick = () => searchUsers(text);
    searchResults.appendChild(btn);
  }
});

async function searchUsers(name){
  searchResults.innerHTML = "Searching...";
  const q = query(collection(db, "users"), where("displayName", "==", name));
  const snap = await getDocs(q);

  searchResults.innerHTML = "";
  if(snap.empty){
    searchResults.innerHTML = `<p>No user found with name "${name}"</p>`;
    return;
  }

  snap.forEach(doc=>{
    const user = doc.data();
    const div = document.createElement("div");
    div.className = "profile-card";
    div.innerHTML = `
      <img src="${user.photoURL || 'https://www.gravatar.com/avatar/?d=mp'}" alt="pfp">
      <h3>${user.displayName}</h3>
      <p>${user.email}</p>
    `;
    searchResults.appendChild(div);
  });
}

// --- 📦 DYNAMIC CATALOG ---
async function loadCatalog(){
  const snap = await getDocs(collection(db, "catalog"));
  const catalogDiv = document.getElementById("catalog");
  catalogDiv.innerHTML = "";

  snap.forEach(doc=>{
    const item = doc.data();
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <img src="${item.image}" alt="${item.name}">
      <h3>${item.name}</h3>
      <p>${item.description || ""}</p>
    `;
    catalogDiv.appendChild(div);
  });
}

loadCatalog();
</script>
</body>
</html>